<#include "/common/frame/global-settings.html">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<#if invoiceNumber=='new'>
	<#assign displayTitle="Create Invoice">
<#else>
	<#assign displayTitle="Invoice: "+invoiceNumber>
</#if>
<title>${displayTitle}</title> 
<#include '/common/resource.html'>
</head>
<body>

	<div id="mail-preview-container" style="display: none;"></div>
	<div id="reportPreviewContainer" style="display: none;" data-url="${basePath}/invoice/${invoiceNumber}/report/cloudpath.json">
		<embed src="" width="650" height="800" >
	</div>
	<div id="contentZone">
		<div id="headerDate">
			<p id="date">${.now?string('EEEEEE dd MMM yyyy')}</p>
		</div>
		<div id="contentContainer">
			<div id="contentCommon">
				<h1>${displayTitle}</h1>
				<#include '/common/frame/user-action.html'>
			</div>
			<div id="content">

				<div id="contentBody">
					<form action="#" autocomplete="off" method="post" id="detail-form">
						<input type="hidden" name="resellerSerialNo" value='${invoice.resellerSerialNo}'/>
						<div id="actionBar">
							<ul>
							<@shiro.hasPermission name="invoice:edit">
								<li><button class="link-btn edit-btn" type="button">Edit</button></li>
								<li><button class="link-btn save-btn">Save</button></li>
								<li><button class="link-btn cancel-btn" type="reset">Cancel</button></li>
							</@shiro.hasPermission>
								<li class="emailBtn rightAligned"><a href="" data-url="${basePath}/invoice/${invoiceNumber}/report/mail/{0}" id="preview-send-email">Email</a></li>
								<li class="emailBtn rightAligned"><select id="mailType" style="margin: 5px 0 0 0; width: 110px;"> <#assign
										dataList=transforEnumToList('au.com.isell.rlm.module.agent.domain.AgentEmailTemplate$Type',"false")>
										<@htmlGen.selOptions '0' dataList {"key":"key","display":"name"}/>
								</select></li>								
							</ul>
						</div>

						<div>
							<div class="commonBox" style="width:45%;">
								<h2>Details</h2>
								<table>
									<tr>
										<td>Invoice Number</td>
										<td>
											<input  type="text" size="30" value="${invoice.invoiceNumber!}" name="invoiceNumber" class="disabled" id="invoiceNumber" readOnly='readOnly'/>
											<input type="checkbox" name="businessType" value="NewBusiness" ${((invoice.businessType=='NewBusiness')?string( "checked='checked'",""))!}/> New Business
										</td>
									</tr>

									<tr>
										<td>Invoice Date</td>
										<td>
											<#if invoice.invoiceDate??>
												<input type="date" size="30" value="${invoice.invoiceDate?date}" name="invoiceDate" />
											<#else>
												<input type="date" size="30" name="invoiceDate" />
											</#if>
											<input type="button" id="clear-calendar" class="clear-calendar-btn" />
										</td>
									</tr>

									<tr>
										<td>Created Date</td>
										<td>
										<#if invoice.createdDate??>
												<input class="unmodified" type="date" size="30" value="${invoice.createdDate?date}" name="createdDate"  disabled='disabled'/>
											<#else>
												<input class="unmodified" type="date" size="30" name="createdDate"  disabled='disabled'/>
											</#if>
										</td>
									</tr>

									<tr>
										<td>Followup Date</td>
										<td>
											<#if invoice.followupDate??>
												<input type="date" size="30" value="${invoice.followupDate?date}" name="followupDate"  />
											<#else>
												<input type="date" size="30" name="followupDate"  />
											</#if>
											<input type="button" id="clear-calendar" class="clear-calendar-btn" />
										</td>
									</tr>
									<tr>
										<td>Expected Payment Date</td>
										<td>
											<#if invoice.promisedPaymentDate??>
												<input type="date" size="30" value="${invoice.promisedPaymentDate?date}" name="promisedPaymentDate"  />
											<#else>
												<input type="date" size="30" name="promisedPaymentDate"  />
											</#if>
											<input type="button" id="clear-calendar" class="clear-calendar-btn" />
										</td>
									</tr>
									<tr>
										<td>Probaility</td>
										<td><select name="probability" style="width:140px;">
												 <#assign dataList=transforEnumToList('au.com.isell.rlm.module.invoice.domain.Invoice$PaymentProbaility',"false")>
												<@htmlGen.selOptions invoice.probability!'' dataList {"key":"key","display":"name"}/>
										</select></td>
									</tr>
									<tr>
										<td>Payment Terms</td>
										<td><select name="paymentTerm" style="width:140px;">
												 <#assign dataList=transforEnumToList('au.com.isell.rlm.module.invoice.domain.Invoice$PaymentTerm',"false")>
												<@htmlGen.selOptions invoice.paymentTerm!'' dataList {"key":"key","display":"name"}/>
										</select></td>
									</tr>

									<tr>
										<td>Agent</td>
										<td><select name="agentId" id="agentId" style="width:140px;"> <#assign
												dataList=dataLoader('au.com.isell.rlm.module.agent.service.AgentService',"getAgencyList")> 
												<@htmlGen.selOptions agentId dataList {"key":"agentId","display":"name"}/>
										</select></td>
									</tr>

									<tr>
										<td>Region</td>
										<td>
											<input type="text" class='unmodified' disabled='disabled' value='${regionName!}'/>
											<input type='hidden' value='${invoice.regionCode!}' name='regionCode' id='regionCode'/>
										</td>
									</tr>

									<tr>
										<td>Rep/User</td>
										<td><select reg='^.+$' name="salesRepId" data-value='${invoice.salesRepId!}' id="salesRepId" data-url='${basePath}/users/sales-repos/{0}.json' style="width:140px;"></select></td>
									</tr>

									<tr>
										<td>Status</td>
										<td><select name="status" style="width:140px;">
												<#assign dataList=transforEnumToList('au.com.isell.rlm.module.invoice.domain.Invoice$InvoiceStatus',"false")>
												<@htmlGen.selOptions invoice.status!'' dataList {"key":"key","display":"name"}/>
										</select></td>
									</tr>
								</table>
							</div>

							<div class="commonBox" style="width:45%;">
								<h2>Amounts</h2>
								<table>
									<tr>
										<td>Total Amount Ex</td>
										<td><input  type="text" size="10" value="${invoice.totalAmount!}" class="unmodified" disabled="disabled" id='totalAmount'/></td>
										<td>Total Amount Inc</td>
										<td><input  type="text" size="10" value="${invoice.totalAmountInc!}" class="unmodified" disabled="disabled" id='totalAmountInc'/></td>
									</tr>
									<tr>
										<td>Total Paid Inc</td>
										<td><input  type="text" size="10"  value="${totalPaid!}" id="totalPaid" disabled="disabled" class='unmodified' /></td>										
										<td>Total Owning Inc</td>
										<td><input  type="text" size="10" value="${totalOwning!}" id="totalOwning"   disabled="disabled" class='unmodified'/></td>
									</tr>

									<#assign dataList=transforEnumToList('au.com.isell.rlm.module.invoice.domain.Invoice$AmountType',"false")>
									<#list dataList as item>
										<tr>
											<td>&nbsp;-&nbsp;${item.name}</td>
											<td><input type="text" size="10" value="${(amounts[item.key])!}" name="amount.${item.key}" reg="^\d*\.{0,1}\d*$" tip="number"/>
											</td>
										</tr>
									</#list>
									<tr>
										<td>Currency</td>
										<td>
											<input  type="hidden" value="${currencySymbol}" data-name="currencySymbol"/>
											<input  type="text" size="10" value="${currency}" name="currency" readOnly="readOnly" class="disabled" id="currency"/>
											<!--<a href="" id="chooseCurrency"><img src="${basePath}/media/search.png"/></a><input type="text" id="currencyFilter" style="display:none;"/>-->
										</td>
									</tr>

									<tr>
										<td>Tax</td>
										<td><input  type="text" size="10" value="${taxRateDisp!}" id="taxRateDisp" class='unmodified disabled' disabled='disabled'/>
										</td>
									</tr>

									<tr>
										<td>Agents Commission</td>
										<td><input type="text" size="10"   /></td>
									</tr>
								</table>
							</div>

							<div style="clear: both;"></div>
						</div>

						<div>
							<div class="commonBox" style="width:45%;">
								<h2>Attention To</h2>
								<table>
									<tr>
										<td>First Name</td>
										<td><input type="text" size="30" value="${invoice.toFirstName!}" name="toFirstName" /></td>
									</tr>

									<tr>
										<td>Last Name</td>
										<td><input type="text" size="30" value="${invoice.toLastName!}" name="toLastName" /></td>
									</tr>

									<tr class="rs-phone">
										<td>Phone</td>
										<td><input class="disabled unmodified phone-prefix"  type="text" size="1" value="${phonePrefix!}" disabled="disabled" /> <input type="text" size="10"
											  class="phone-number" value="${invoice.toPhone!}" name="toPhone" /></td>
									</tr>

									<tr class="rs-phone">
										<td>Mobile</td>
										<td><input class="disabled unmodified phone-prefix"  type="text" size="1" value="${phonePrefix!}" disabled="disabled" /> <input type="text" size="10"
											  class="phone-number" value="${invoice.toMobile!}" name="toMobile" /></td>
									</tr>

									<tr>
										<td>Email</td>
										<td><input type="text" size="35"   value="${invoice.toEmail!}" name="toEmail"/></td>
									</tr>

									<tr>
										<td>Email cc</td>
										<td><input type="text" size="35"   value="${invoice.toEmailcc!}" name="toEmailcc"/></td>
									</tr>
								</table>
							</div>

							<div class="commonBox" style="width:45%;">
								<h2>Internal Notes</h2>
								<textarea rows="7" cols="80" name="notes">${invoice.notes!}</textarea>
							</div>

							<div style="clear: both;"></div>
						</div>
						<#if invoiceNumber!="new">
							<div>
								<div class="commonBox" style="width:45%;">
									<div id="invoice-schedule-list">
										<#include "invoice-schedule-list.html"/>
									</div>
								</div>
	
								<div class="commonBox" style="width:45%;">
									<div id="invoice-followup-list">
										<#include "invoice-followup-list.html"/>
									</div>
								</div>
	
								<div style="clear: both;"></div>
							</div>
						</#if>
						<div>
							<div class="commonBox" style="width:45%;">
								<h2>
									Invoice Details<span class="invoiceChildBtn rightAligned" id="createDetails">
									<button class="link-btn" type="button" id="detailsEdit" >Unlock</button>
									<button class="link-btn" type="button" id="detailsDone" >Lock</button>
									</span>
								</h2>
								<textarea rows="15" cols="80" name="details" id="details" class="unmodified" disabled='disabled'>${invoice.details!}</textarea>
							</div>

							<div class="commonBox" style="width:45%;">
								<h2>
									Terms and Conditions<span class="invoiceChildBtn rightAligned" id="createTerms">
									<button class="link-btn" id="termsEdit" type="button">Unlock</button>
									<button class="link-btn" id="termsDone" type="button">Lock</button>
									</span>
								</h2>
								<textarea rows="15" cols="80" name="terms" id="terms" class="unmodified" disabled='disabled'>${invoice.terms!}</textarea>
							</div>

							<div style="clear: both;"></div>
						</div>

						<div style="clear: both;"></div>
					</form>
				</div>
			</div>

		</div>
	</div>
	<script type="text/javascript" src="${resourceBasePath}/js/entry/agent/module/invoice/invoice-detail.js"></script>
	<script type="text/javascript" src="${resourceBasePath}/js/entry/agent/module/invoice/invoice-mail.js"></script>
</body>
</html>